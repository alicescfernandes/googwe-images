"use strict";class ISearchEngine{constructor(t,e=!1){this.allpictures=new Pool(1500),this.localStorageKey="images",this.itemsPerPage=20,this.currentPage=0,this.queryResults=[],this.fastLoad=e,this.colors=["red","orange","yellow","green","Blue-green","blue","purple","pink","white","grey","black","brown"],this.redColor=[204,251,255,0,3,0,118,255,255,153,0,136],this.greenColor=[0,148,255,204,192,0,44,152,255,153,0,84],this.blueColor=[0,11,0,0,198,255,167,191,255,153,0,24],this.hexColor=["#00000000","#cc0000","#fb940b","#ffff00","#00cc00","#03c0c6","#0000ff","#762ca7","#ff98bf","#ffffff","#999999","#000000","#885418"],this.categories=["beach","birthday","face","indoor","manmade/artificial","manmade/manmade","manmade/urban","marriage","nature","no_people","outdoor","party","people","snow"],this.XML_file=t,this.XML_db=new XML_Database,this.LS_db=new LocalStorageXML,this.num_Images=1,this.numshownpic=35,this.imgWidth=190,this.imgHeight=140}init(t){this.createXMLIExampledatabaseLS()}databaseProcessing(t){new ColorHistogram(this.redColor,this.greenColor,this.blueColor),new ColorMoments;let e="processed_picture_"+new Picture(0,0,100,100,"Images/daniel1.jpg","test").impath;new Event(e);document.addEventListener(e,(function(){}),!1)}imageProcessed(t,e){this.allpictures.insert(t)}createXMLIExampledatabaseLS(){var t=document.querySelector("canvas"),e=new ColorHistogram(this.redColor,this.greenColor,this.blueColor),s=new ColorMoments,r=new Event("processed_picture"),o=this;if(1==this.fastLoad)this.XML_db.loadXMLfile(this.XML_file).then(t=>{localStorage.setItem(this.localStorageKey,t.documentElement.outerHTML);var e=(t=this.LS_db.readLS_XML(this.localStorageKey)).querySelectorAll("image");for(let t=0;t<e.length;t++){let s=new Picture(0,0,0,0,e[t],e[t].getAttribute("keywords"));s.setColorMoments(JSON.parse(e[t].getAttribute("colorMoments"))),s.setManhattan(JSON.parse(e[t].getAttribute("histogram"))),this.imageProcessed(s)}});else if(localStorage.getItem(this.localStorageKey)&&0==this.fastLoad){var i=this.LS_db.readLS_XML(this.localStorageKey).querySelectorAll("image");for(let t=0;t<i.length;t++){let e=new Picture(0,0,0,0,i[t],i[t].getAttribute("keywords"));e.setColorMoments(JSON.parse(i[t].getAttribute("colorMoments"))),e.setManhattan(JSON.parse(i[t].getAttribute("histogram"))),this.imageProcessed(e)}}else this.XML_db.loadXMLfile(this.XML_file).then(i=>{window.location.hash="#/loading";var l=i.querySelectorAll("image");let a=[];for(let i=0;i<l.length;i++){let n=l[i].querySelector("title").textContent.toLowerCase().replace(/ -/g,"").replace(/ /g,","),h=new Picture(0,0,0,0,l[i],n).computation(t,e,s,r);l[i].querySelector("latitude").remove(),l[i].querySelector("longitude").remove(),l[i].querySelector("date").remove(),h.then(t=>{console.count("resolved"),l[i].setAttribute("dominantColor",t.dominantColor),l[i].setAttribute("colorMoments",JSON.stringify(t.color_moments)),l[i].setAttribute("histogram",JSON.stringify(t.hist)),l[i].setAttribute("width",t.imgobj.width),l[i].setAttribute("height",t.imgobj.height),l[i].setAttribute("keywords",t.keywords),o.imageProcessed(t)}),a.push(h)}Promise.all(a).then(()=>{this.LS_db.saveLS_XML(this.localStorageKey,i.documentElement.outerHTML),window.location.hash=""})})}zscoreNormalization(){let t=[],e=[];for(let s=0;s<this.allpictures.stuff[0].color_moments.length;s++)t.push(0),e.push(0);for(let e=0;e<this.allpictures.stuff.length;e++)for(let s=0;s<this.allpictures.stuff[0].color_moments.length;s++)t[s]+=this.allpictures.stuff[e].color_moments[s];for(let e=0;e<this.allpictures.stuff[0].color_moments.length;e++)t[e]/=this.allpictures.stuff.length;for(let s=0;s<this.allpictures.stuff.length;s++)for(let r=0;r<this.allpictures.stuff[0].color_moments.length;r++)e[r]+=Math.pow(this.allpictures.stuff[s].color_moments[r]-t[r],2);for(let t=0;t<this.allpictures.stuff[0].color_moments.length;t++)e[t]=Math.sqrt(e[t]/this.allpictures.stuff.length);for(let s=0;s<this.allpictures.stuff.length;s++)for(let r=0;r<this.allpictures.stuff[0].color_moments.length;r++)this.allpictures.stuff[s].color_moments[r]=(this.allpictures.stuff[s].color_moments[r]-t[r])/e[r]}search(t,e){this.currentPage=0;this.LS_db.readLS_XML(this.localStorageKey);let s=t.trim().split(" ").join("|"),r=RegExp(s,"g"),o=this.allpictures.stuff.filter(t=>null!=t.keywords.match(r));if(""!=e){e=parseInt(e);let t=[];this.allpictures.stuff.forEach((function(e){t=t.concat(e.hist)})),t=Math.max(...t),o=this.sortByHistogramDistance(e,o)}return this.queryResults=o,this.loadMore()}loadMore(){var t=this.currentPage,e=this.currentPage+1;return this.currentPage++,this.queryResults.slice(this.itemsPerPage*t,this.itemsPerPage*e)}searchISimilarity(t){var e=[];for(let r in this.allpictures.stuff){var s=this.calcManhattanDist(t,this.allpictures.stuff[r]);e.push([s,this.allpictures.stuff[r]])}return this.currentPage=0,this.queryResults=this.sortByColorMoments(e).map((function(t){return t[1]})),this.loadMore()}calcManhattanDist(t,e){let s=0;for(let r=0;r<t.color_moments.length;r++)for(let o=0;o<t.color_moments[r].length;o++)s+=Math.abs(t.color_moments[r][o]-e.color_moments[r][o]);return s/=t.color_moments.length,s}sortByHistogramDistance(t,e){return e.sort((function(e,s){return s.hist[t]-e.hist[t]}))}sortByColorMoments(t){return t.sort((function(t,e){return t[0]-e[0]}))}gridView(t){}}class Pool{constructor(t){this.size=t,this.stuff=[]}insert(t){this.stuff.length<this.size?this.stuff.push(t):alert("The application is full: there isn't more memory space to include objects")}remove(){0!==this.stuff.length?this.stuff.pop():alert("There aren't objects in the application to delete")}empty_Pool(){for(;this.stuff.length>0;)this.remove()}}