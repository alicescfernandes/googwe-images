var myWorker=new Worker("js/worker.js");function enqueueWorkerCallback(t,e){window.workerCallbackQueue=window.workerCallbackQueue||[],window.workerCallbackQueue[e]=t}myWorker.addEventListener("message",(function(t){window.workerCallbackQueue[t.data.id](t),workerCallbackQueue[t.data.id](t)}));class Picture{constructor(t,e,o,i,s,a,l=!0){this.posx=t,this.posy=e,this.keywords=a,l?(this.impath=s.querySelector("path").textContent,this.category=s.className,this.title=s.querySelector("title").textContent,this.dominantColor=s.querySelector("dominantcolor").textContent.toLowerCase()):(this.impath=s,this.category="",this.title="",this.dominantColor=""),this.w=0,this.h=0,this.imgobj=new Image,this.imgobj.src=this.impath,this.original_w=this.imgobj.width,this.original_h=this.imgobj.height,this.hist=[],this.color_moments=[],this.manhattanDist=[],this.awaitingSW=!1}draw(t){let e=t.getContext("2d");if(this.imgobj.complete)e.drawImage(this.imgobj,this.posx,this.posy,this.w,this.h),console.log("Debug: N Time");else{console.log("Debug: First Time");let t=this;this.imgobj.addEventListener("load",(function(){e.drawImage(t.imgobj,t.posx,t.posy,t.w,t.h)}),!1)}}getAll(t,e){myWorker.postMessage({id:this.impath,command:"calculate_all",pixels:t.data,blocks:e})}computation(t,e,o){let i=this,s=t.getContext("2d");return new Promise((function(e,a){i.imgobj.addEventListener("load",(function(){s.drawImage(i.imgobj,0,0,i.imgobj.width,i.imgobj.height);let a=s.getImageData(0,0,i.imgobj.width,i.imgobj.height);i.getAll(a,o.getBlocks(i.imgobj,t)),enqueueWorkerCallback((function(t){if("all_result"==t.data.result&&t.data.id==i.impath){let[o,s]=t.data.data;i.hist=o,i.color_moments=s,e(i)}}),i.impath)}),!1)}))}setManhattan(t){this.hist=t}setColorMoments(t){this.color_moments=t}generateTag(){return`<img src='${this.impath}'></img>`}build_Color_Rect(t,e,o,i,s){let a=canvas.getContext("2d");a.font="12px Arial";for(let t=0;t<o.length;t++)a.fillStyle="rgb("+o[t]+","+i[t]+","+s[t]+")",a.fillRect(80*t,400,50,50),8===t&&(a.fillStyle="black"),a.fillText(e[t],80*t,390)}setPosition(t,e){this.posx=t,this.posy=e}mouseOver(t,e){return t>=this.posx&&t<=this.posx+this.w&&e>=this.posy&&e<=this.posy+this.h}}class ColorHistogram{constructor(t,e,o){}}class ColorMoments{constructor(){this.h_block=3,this.v_block=3}getBlocks(t,e){let o=Math.floor(t.width/this.h_block),i=Math.floor(t.height/this.v_block);var s=[];let a=o,l=i;var r="";let h=e.getContext("2d");h.drawImage(t,0,0);for(let t=0;t<3;t++)for(let e=0;e<3;e++)r=h.getImageData(a*t,l*e,a,l),s.push(r.data);return s}}