var myWorker=new Worker("js/worker.js");myWorker.onmessage=function(t){result.textContent=t.data,console.log("Message received from worker")};class Picture{constructor(t,e,o,s,i,a){this.posx=t,this.posy=e,this.w=o,this.h=s,this.impath=i,this.imgobj=new Image,this.imgobj.src=this.impath,this.original_w=this.imgobj.width,this.original_h=this.imgobj.height,this.category=a,this.hist=[],this.color_moments=[],this.manhattanDist=[]}draw(t){let e=t.getContext("2d");if(this.imgobj.complete)e.drawImage(this.imgobj,this.posx,this.posy,this.w,this.h),console.log("Debug: N Time");else{console.log("Debug: First Time");let t=this;this.imgobj.addEventListener("load",(function(){e.drawImage(t.imgobj,t.posx,t.posy,t.w,t.h)}),!1)}}computation(t,e,o,s){let i=this,a=t.getContext("2d"),h=s;return new Promise((function(t,o){if(i.imgobj.complete){console.trace("Debug: N Time"),a.drawImage(i.imgobj,0,0,i.imgobj.width,i.imgobj.height);let o=a.getImageData(0,0,i.imgobj.width,i.imgobj.height);e.count_Pixels_async(o).then(t=>{i.hist=t,console.log(i.hist)}),t([]),document.dispatchEvent(h)}else console.trace("Debug: First Time"),i.imgobj.addEventListener("load",(function(){a.drawImage(i.imgobj,0,0,i.imgobj.width,i.imgobj.height);let o=a.getImageData(0,0,i.imgobj.width,i.imgobj.height);e.count_Pixels_async(o).then(t=>{i.hist=t,console.log(i.hist)}),t([]),document.dispatchEvent(h)}),!1)}))}build_Color_Rect(t,e,o,s,i){let a=canvas.getContext("2d");a.font="12px Arial";for(let t=0;t<o.length;t++)a.fillStyle="rgb("+o[t]+","+s[t]+","+i[t]+")",a.fillRect(80*t,400,50,50),8===t&&(a.fillStyle="black"),a.fillText(e[t],80*t,390)}setPosition(t,e){this.posx=t,this.posy=e}mouseOver(t,e){return t>=this.posx&&t<=this.posx+this.w&&e>=this.posy&&e<=this.posy+this.h}}class ColorHistogram{constructor(t,e,o){this.redColor=t,this.greenColor=e,this.blueColor=o,this.limit=4}count_Pixels(t){let e=Array(this.redColor.length);for(let o=0;o!=t.length;o+=4){this.calculateManhattan(t[o],t[o+1],t[o+2]).forEach((t,o)=>{t>3&&(e[o]=e[o]+1||1)})}return e}count_Pixels_async(t){Array(this.redColor.length);myWorker.postMessage({command:"calculate_manhattan",data:t.data}),console.log("Message posted to worker"),console.log("manhattan")}calculateManhattan(t,e,o){let s=[];for(let i=0;i!=this.redColor.length;i++){let a=Math.abs(t-this.redColor[i]),h=Math.abs(e-this.greenColor[i]),l=Math.abs(o-this.blueColor[i]);s.push(a+h+l)}return s}}class ColorMoments{constructor(){this.h_block=3,this.v_block=3}rgbToHsv(t,e,o){let s=t/255,i=e/255,a=o/255,h=Math.max(s,i,a),l=Math.min(s,i,a),r=null,n=null,g=h,c=h-l;if(n=0==h?0:c/h,h==l)r=0;else{switch(h){case s:r=(i-a)/c+(i<a?6:0);break;case i:r=(a-s)/c+2;break;case a:r=(s-i)/c+4}r/=6}return[r,n,g]}moments(t,e){let o=Math.floor(t.width/this.h_block),s=Math.floor(t.height/this.v_block);var i=[];let a=o,h=s;var l="";let r=e.getContext("2d");r.drawImage(t,0,0);for(let t=0;t<3;t++)for(let e=0;e<3;e++)l=r.getImageData(a*t,h*e,a,h),i.push(this.calculateMonents(l));return r.clearRect(0,0,canvas.width,canvas.height),r.putImageData(l,0,0),Promise.all(i)}calculateMonents(t){let e=0,o=0,s=0,i=t.data.length/4,a=0,h=0,l=0;for(let i=0;i<t.data.length;i+=4){var[r,n,g]=this.rgbToHsv(t.data[i],t.data[i+G],t.data[i+B]);e+=r,o+=n,s+=g,a+=r**2,h+=n**2,l+=g**2}return e/=t.data.length/4,o/=t.data.length/4,s/=t.data.length/4,a=(a-i*e**2)/(i-1),h=(h-i*s**2)/(i-1),l=(l-i*o**2)/(i-1),[e,s,o,a,h,l]}}var R=0,G=1,B=2,ALPHA=3;