const redColor=[204,251,255,0,3,0,118,255,255,153,0,136],greenColor=[0,148,255,204,192,0,44,152,255,153,0,84],blueColor=[0,11,0,0,198,255,167,191,255,153,0,24];var R=0,G=1,B=2,ALPHA=3;class ColorHistogram{constructor(t,e,a){this.redColor=t,this.greenColor=e,this.blueColor=a,this.threshold=400}count_Pixels(t){let e=Array(this.redColor.length);for(let a=0;a!=t.length;a+=4){this.calculateManhattan(t[a],t[a+1],t[a+2]).forEach((t,a)=>{let[l,o,s,r]=t;e[a]=l<400?e[a]+1||1:0})}return e}calculateManhattan(t,e,a){let l=[];for(let o=0;o!=this.redColor.length;o++){let s=Math.abs(t-this.redColor[o]),r=Math.abs(e-this.greenColor[o]),n=Math.abs(a-this.blueColor[o]);l.push([s+r+n,s,r,n])}return l}}class ColorMoments{constructor(){this.h_block=3,this.v_block=3}rgbToHsv(t,e,a){let l=t/255,o=e/255,s=a/255,r=Math.max(l,o,s),n=Math.min(l,o,s),c=null,h=null,i=r,u=r-n;if(h=0==r?0:u/r,r==n)c=0;else{switch(r){case l:c=(o-s)/u+(o<s?6:0);break;case o:c=(s-l)/u+2;break;case s:c=(l-o)/u+4}c/=6}return[c,h,i]}moments(t){var e=[];for(let a in t)e.push(this.calculateMonents(t[a]));return e}calculateMonents(t){let e=0,a=0,l=0,o=t.length/4,s=0,r=0,n=0;for(let o=0;o<t.length;o+=4){var[c,h,i]=this.rgbToHsv(t[o],t[o+G],t[o+B]);e+=c,a+=h,l+=i,s+=c**2,r+=h**2,n+=i**2}return e/=t.length/4,a/=t.length/4,l/=t.length/4,s=(s-o*e**2)/(o-1),r=(r-o*l**2)/(o-1),n=(n-o*a**2)/(o-1),[e,l,a,s,r,n]}}let ch=new ColorHistogram(redColor,greenColor,blueColor),cm=new ColorMoments;this.onmessage=function(t){let e=t.data.data,a="";switch(t.data.command){case"calculate_manhattan":a=ch.count_Pixels(e),this.postMessage({result:"manhattan_result",data:a});break;case"calculate_moment":a=cm.moments(e),this.postMessage({result:"moment_result",data:a});break;case"calculate_all":var l=new Uint32Array(1);this.crypto.getRandomValues(l)[0];var o={result:"all_result",id:t.data.id,data:[ch.count_Pixels(t.data.pixels),cm.moments(t.data.blocks)]};this.postMessage(o);break;default:this.console.log("command not recognized")}};